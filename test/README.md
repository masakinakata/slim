# テストスクリプトについて
テストはTAP（Test Anything Protocol）を用いて行います。
新たなテストが必要な場合はMakefile.amのTESTS変数にスクリプトを追加し、TAPにしたがって結果を出力してください。
LMNtalプログラムのテストを追加する場合は、system_checkディレクトリ以下に.lmntestファイルとcheck.shファイルを追加してください。その上で、Makefile.amのTESTS変数に追加したcheck.shファイルを、check_DATA変数に追加した.lmntestファイルを追加してください。

check.shファイルは./check.plを呼び出し、引数として全てのテストしたい.lmntestファイルを一度に与えてください。.lmntestファイルは１行目にテストしたいLMNtalプログラム、２行目にLMNtalプログラムの予想される出力、３行目に’ok’または’ng’を記述してください。okは１行目の結果が２行目と等しいとき、ngは１行目の結果が２行目と異なるときにテストに成功します。４行目以降にはLMNtalコメント以外は書かないでください。

----

元々のテストスクリプトはLMNtal処理系用のテストスクリプトを流用したもので以下のような欠点がありました。

- テストが走るたびにlmnファイルをコンパイルする
- テストの結果如何にかかわらずPASS: 1のみを表示する
- ~.logにテスト結果が出力される

１回のテストに５分程度かかるため、自動テストの利点があまり発揮できていませんでした。
そこで、AutomakeのTAPを用いてよりテストの利便性を高めました。
コンパイルを毎回しなくとも良いようにテストケースごとにファイルに分け、makeによって監視しています。
lmntestファイルをコンパイルする必要がある場合はcreate_testdata.awkスクリプトによって正当なLMNtalプログラムへと作り替えます。
この作り替えられたプログラムはテストが正しく行われた場合最終状態のプロセスにokを含みます。
check.plはlmntestから作成されたilファイルをslimに与えて実行し、結果にokがあるかどうかを検査します。

2016/12/30 tomioka